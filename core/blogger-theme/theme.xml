<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html>
<html b:css='false' b:responsive='true' xmlns='http://www.w3.org/1999/xhtml' xmlns:b='http://www.google.com/2005/gml/b' xmlns:data='http://www.google.com/2005/gml/data' xmlns:expr='http://www.google.com/2005/gml/expr'>

<head>
  <meta charset='UTF-8'/>
  <meta content='width=device-width, initial-scale=1.0' name='viewport'/>
  <title><data:blog.pageTitle/></title>

  <link href='https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css' rel='stylesheet'/>
  <link href='https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css' rel='stylesheet'/>
  <link href='https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&amp;display=swap' rel='stylesheet'/>

  <b:skin><![CDATA[
    body { background-color:#f5f5f5; }
  ]]></b:skin>
</head>

<body>

  <b:section class='main' id='main' maxwidgets='1' showaddelement='no'>
    <b:widget id='HTML1' locked='true' title='SPA Body' type='HTML' version='1'>
      <b:widget-settings>
        <b:widget-setting name='content'/>
      </b:widget-settings>
      <b:includable id='main'>

        <!-- Website Type Selector -->
        <div class='container website-type-selector'>
          <div class='selector-group'>
            <div>
              <label class='selector-label'>Website Type:</label>
              <select class='selector-select' id='websiteTypeSelector'>
                <option value='Business'>Business</option>
                <option value='E-commerce'>E-commerce</option>
                <option value='Portfolio'>Portfolio</option>
                <option value='Blog'>Blog</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Loading Container -->
        <div class='loading-container' id='loadingContainer' style='display:flex;'>
          <div class='loading-spinner'/>
          <div class='loading-text'>Loading website content...</div>
        </div>

        <!-- Main Content -->
        <section class='container' id='mainContent' style='display:none;'>
          <!-- Content will be loaded here dynamically -->
        </section>

      </b:includable>
    </b:widget>
  </b:section>

  <script src='https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js'/>
  <script>
    // Configuration
    const WEB_APP_URL = 'YOUR_WEB_APP_URL';
    let currentWebsiteType = 'Business';
    let allData = [];

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      fetchWebsiteTypes();
    });

    // Fetch website types
    function fetchWebsiteTypes() {
      const script = document.createElement('script');
      script.src = `${WEB_APP_URL}?action=getWebsiteTypes&callback=handleWebsiteTypes`;
      document.body.appendChild(script);
    }

    // Handle website types response
    function handleWebsiteTypes(data) {
      // Fetch initial data
      fetchData();
    }

    // Fetch data for current website type
    function fetchData() {
      const oldScript = document.getElementById('jsonp-data-script');
      if (oldScript) oldScript.remove();

      const script = document.createElement('script');
      script.id = 'jsonp-data-script';
      script.src = `${WEB_APP_URL}?action=getData&websiteType=${currentWebsiteType}&callback=handleDataResponse`;
      document.body.appendChild(script);
    }

    // Handle data response
    function handleDataResponse(data) {
      allData = data;
      document.getElementById('loadingContainer').style.display = 'none';
      document.getElementById('mainContent').style.display = 'block';
      
      // Generate HTML based on website type
      if (currentWebsiteType === 'E-commerce') {
        generateEcommerceHTML(data);
      } else if (currentWebsiteType === 'Portfolio') {
        generatePortfolioHTML(data);
      } else if (currentWebsiteType === 'Blog') {
        generateBlogHTML(data);
      } else {
        generateGenericHTML(data);
      }
    }

    // Generate HTML functions
    function generateEcommerceHTML(categories) {
      let html = '<div class="product-grid">';
      categories.forEach(category => {
        category.posts.forEach(product => {
          html += `
            <div class="product-item">
              <h3>${product.title}</h3>
              <p>${product.description}</p>
              <p>Price: ${product.price} ${product.currency}</p>
            </div>
          `;
        });
      });
      html += '</div>';
      document.getElementById('mainContent').innerHTML = html;
    }

    function generatePortfolioHTML(projects) {
      let html = '<div class="portfolio-grid">';
      projects.forEach(project => {
        html += `
          <div class="portfolio-item">
            <h3>${project.title}</h3>
            <p>${project.description}</p>
          </div>
        `;
      });
      html += '</div>';
      document.getElementById('mainContent').innerHTML = html;
    }

    function generateBlogHTML(posts) {
      let html = '<div class="blog-container">';
      posts.forEach(post => {
        html += `
          <article class="blog-post">
            <h3>${post.title}</h3>
            <p>${post.excerpt}</p>
            <small>${post.publishedDate}</small>
          </article>
        `;
      });
      html += '</div>';
      document.getElementById('mainContent').innerHTML = html;
    }

    function generateGenericHTML(data) {
      generateBlogHTML(data);
    }
  </script>
  <style>
    .website-type-selector { margin: 20px 0; }
    .selector-group { display: flex; gap: 15px; align-items: center; }
    .selector-label { font-weight: 600; }
    .selector-select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
    .loading-container { display: flex; justify-content: center; align-items: center; padding: 50px; }
    .loading-spinner { width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; animation: spin 1s linear infinite; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    .product-grid, .portfolio-grid, .blog-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin: 20px 0; }
    .product-item, .portfolio-item, .blog-post { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
  </style>

</body>
</html>
