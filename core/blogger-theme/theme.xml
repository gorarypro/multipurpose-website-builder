<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html>
<html b:css='false' b:responsive='true' xmlns='http://www.w3.org/1999/xhtml' xmlns:b='http://www.google.com/2005/gml/b' xmlns:data='http://www.google.com/2005/gml/data' xmlns:expr='http://www.google.com/2005/gml/expr'>
<head>
  <meta charset='UTF-8'/>
  <meta content='width=device-width, initial-scale=1.0' name='viewport'/>
  <title><data:blog.pageTitle/></title>
  <link href='https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css' rel='stylesheet'/>
  <link href='https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css' rel='stylesheet'/>
  <b:skin><![CDATA[ 
    body { background-color: #f5f5f5; font-family: sans-serif; } 
    .site-header { padding: 60px 0; text-align: center; color: white; margin-bottom: 30px; }
    .post-card { background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 20px; }
    .post-card img { width: 100%; height: 200px; object-fit: cover; }
    .post-card-body { padding: 20px; }
  ]]></b:skin>
</head>
<body>
  
  <div id="app">
    <!-- Header -->
    <header id="dynamicHeader" class="site-header" style="background-color: #333;">
      <div class="container">
        <h1 id="siteTitle">Loading Website...</h1>
        <p id="siteType" class="badge bg-light text-dark">Please wait</p>
      </div>
    </header>

    <!-- Matrix Code Input (For user quick nav) -->
    <div class="container mb-4">
        <div class="input-group" style="max-width: 300px; margin: 0 auto;">
            <span class="input-group-text">#</span>
            <input type="text" id="matrixInput" class="form-control" placeholder="Enter code (e.g. 12)" />
            <button class="btn btn-dark" onclick="handleMatrix()">Go</button>
        </div>
    </div>

    <!-- Content Grid -->
    <div class="container">
      <div id="contentGrid" class="row">
         <div class="col-12 text-center p-5">
           <div class="spinner-border text-secondary" role="status"></div>
         </div>
      </div>
    </div>
  </div>

  <!-- Required Widget -->
  <b:section class='main' id='main' maxwidgets='1' showaddelement='no'>
    <b:widget id='HTML1' locked='true' title='App' type='HTML' version='1'>
      <b:widget-settings><b:widget-setting name='content'/></b:widget-settings>
      <b:includable id='main'></b:includable>
    </b:widget>
  </b:section>

  <script>
  //<![CDATA[
    // ** UPDATE THIS URL AFTER DEPLOYING **
    const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbxBOuXmYcOpeijxpBMwEV5clzoUg1zYG6hwQ93AFj5FRjXE3rHPR5fdauhInRh4uB00BA/exec';
    
    document.addEventListener('DOMContentLoaded', () => {
       loadSiteConfig();
    });

    function loadSiteConfig() {
       const script = document.createElement('script');
       script.src = WEB_APP_URL + '?action=getConfig&callback=applyConfig';
       document.body.appendChild(script);
    }

    function applyConfig(config) {
       if(config.title) document.getElementById('siteTitle').textContent = config.title;
       if(config.type) document.getElementById('siteType').textContent = config.type;
       if(config.color) document.getElementById('dynamicHeader').style.backgroundColor = config.color;
       
       // Now load content based on type
       loadContent(config.type);
    }

    function loadContent(type) {
       const script = document.createElement('script');
       script.src = WEB_APP_URL + '?action=getData&type=' + encodeURIComponent(type) + '&callback=renderContent';
       document.body.appendChild(script);
    }

    function renderContent(posts) {
       const grid = document.getElementById('contentGrid');
       if(!posts || posts.length === 0) {
           grid.innerHTML = '<div class="col-12 text-center text-muted">No posts found for this category.</div>';
           return;
       }
       
       let html = '';
       posts.forEach(post => {
           html += `
             <div class="col-md-4">
               <div class="post-card">
                 <img src="${post.imageUrl}" alt="${post.title}">
                 <div class="post-card-body">
                   <h5>${post.title}</h5>
                   <p class="small text-muted">${post.date}</p>
                   <p>${post.excerpt}</p>
                   <button class="btn btn-sm btn-outline-dark">Read More</button>
                 </div>
               </div>
             </div>
           `;
       });
       grid.innerHTML = html;
    }

    function handleMatrix() {
        const code = document.getElementById('matrixInput').value;
        if(code === '12') alert("Navigating to Matrix Shortcut 12...");
        // Implement full matrix logic here if needed
    }
  //]]>
  </script>
</body>
</html>
