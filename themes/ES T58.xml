<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html>
<html b:css='false' b:defaultwidgetversion='2' b:layoutsVersion='3' b:responsive='true' b:version='2' expr:dir='data:blog.languageDirection' xmlns='http://www.w3.org/1999/xhtml' xmlns:b='http://www.google.com/2005/gml/b' xmlns:data='http://www.google.com/2005/gml/data' xmlns:expr='http://www.google.com/2005/gml/expr'>
<head>
  <meta content='width=device-width, initial-scale=1.0, user-scalable=no' name='viewport'/>
  <meta content='IE=edge' http-equiv='X-UA-Compatible'/>
  <title><data:blog.pageTitle/></title>
  
  <link href='https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css' rel='stylesheet'/>
  <link href='https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css' rel='stylesheet'/>
  <link href='https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&amp;display=swap' rel='stylesheet'/>
  
  <b:skin version='1.3.0'><![CDATA[
    <Variable name="keycolor" description="Main Color" type="color" default="#01fe2b" value="#01fe2b"/>
    <Variable name="body.background" description="Background" type="background" color="#fafafa" default="#fafafa none repeat fixed top left" value="#fafafa none repeat fixed top left"/>
  ]]></b:skin>

  <style>
    /* --- CSS VARIABLES --- */
    :root {
      --primary: #01fe2b;
      --secondary: #32a7e2;
      --font-main: 'Poppins', sans-serif;
      --bg-color: #f8f9fa;
      --minibox-color: #d4a574;
      --box-color: #8b6f47;
      --appetizers-color: #a67c52;
      --taco-color: #c4915c;
    }

    /* --- GLOBAL STYLES --- */
    * { box-sizing: border-box; }
    body { font-family: var(--font-main); background-color: var(--bg-color); margin:0; padding:0; overflow-x: hidden; }
    
    /* --- NAVBAR --- */
    .navbar { background-color: rgba(255,255,255,0.95); backdrop-filter: blur(10px); position: sticky; top: 0; z-index: 1030; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
    .navbar-brand { color: var(--primary) !important; font-weight: 800; font-size: 1.5rem; text-transform: uppercase; }
    .nav-link { font-weight: 500; color: #444 !important; transition:0.3s; }
    .nav-link:hover { color: var(--primary) !important; }

    /* --- HERO SECTION --- */
    #hero { 
      background: linear-gradient(135deg, var(--primary), var(--secondary)); 
      color: white; padding: 100px 20px; text-align: center; 
      min-height: 50vh; display: flex; flex-direction: column; 
      justify-content: center; align-items: center; 
      border-radius: 0 0 50px 50px; margin-bottom: 40px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }
    #hero h1 { font-size: 3rem; font-weight: 800; margin-bottom: 15px; text-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    #hero p { font-size: 1.2rem; opacity: 0.9; max-width: 600px; margin: 0 auto 25px; }
    #hero .btn { background: #333; color: white; border-radius: 50px; padding: 12px 35px; font-weight: 700; transition: transform 0.2s; border:none; }
    #hero .btn:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }

    /* --- FILTER BAR --- */
    .filter-container { 
      display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; 
      padding: 15px; position: sticky; top: 80px; 
      background: rgba(255,255,255,0.9); z-index: 1020; 
      border-radius: 50px; margin: 0 auto 30px; max-width: 800px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.05); backdrop-filter: blur(5px);
    }
    .filter-btn { 
      border: 2px solid var(--primary); background: transparent; 
      color: var(--primary); padding: 8px 20px; border-radius: 20px; 
      font-weight: 600; cursor: pointer; transition: 0.3s; 
    }
    .filter-btn:hover, .filter-btn.active { background: var(--primary); color: white; }

    /* --- MENU GRID --- */
    .category-section { margin-bottom: 60px; scroll-margin-top: 160px; }
    .category-header { display: flex; align-items: center; border-bottom: 3px solid; padding-bottom: 10px; margin-bottom: 25px; }
    .category-title { font-size: 1.8rem; font-weight: 800; margin: 0; margin-left: 10px; }
    
    /* Category Colors */
    .minibox { border-color: var(--minibox-color); color: var(--minibox-color); }
    .box { border-color: var(--box-color); color: var(--box-color); }
    .appetizers { border-color: var(--appetizers-color); color: var(--appetizers-color); }
    .taco { border-color: var(--taco-color); color: var(--taco-color); }

    /* --- CARDS --- */
    .menu-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px; }
    .menu-item { 
      background: white; border-radius: 15px; overflow: hidden; 
      box-shadow: 0 5px 15px rgba(0,0,0,0.05); transition: 0.3s; 
      display: flex; flex-direction: column; height: 100%; position: relative;
    }
    .menu-item:hover { transform: translateY(-5px); box-shadow: 0 15px 30px rgba(0,0,0,0.1); }
    
    .card-img-container { position: relative; height: 220px; overflow: hidden; }
    .card-img-container img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.5s; }
    .menu-item:hover .card-img-container img { transform: scale(1.05); }
    
    .price-badge { 
      position: absolute; top: 10px; right: 10px; 
      background: rgba(0,0,0,0.8); color: white; 
      padding: 5px 12px; border-radius: 20px; font-weight: bold; font-size: 0.9rem; 
    }
    .special-offer {
      position: absolute; top: 10px; left: 10px;
      background: #ff4757; color: white;
      padding: 3px 10px; border-radius: 20px; 
      font-size: 0.75rem; text-transform: uppercase; font-weight: bold;
    }
    
    .card-body { padding: 20px; flex-grow: 1; display: flex; flex-direction: column; }
    .card-title { font-size: 1.2rem; font-weight: 700; color: #333; margin-bottom: 8px; }
    .card-text { color: #666; font-size: 0.95rem; margin-bottom: 20px; flex-grow: 1; line-height: 1.5; }
    
    .card-footer { padding: 15px 20px; border-top: 1px solid #f0f0f0; display: flex; justify-content: space-between; align-items: center; background: #fafafa; }
    .price-tag { font-size: 1.3rem; font-weight: 800; color: var(--primary); }
    .order-btn { 
      background: var(--primary); color: white; border: none; 
      padding: 8px 20px; border-radius: 50px; font-weight: 600; 
      cursor: pointer; transition: 0.3s; 
    }
    .order-btn:hover { background: var(--secondary); transform: scale(1.05); }

    /* --- FLOATING & SIDEBAR --- */
    .floating-cart, .floating-whatsapp { 
      position: fixed; right: 20px; width: 60px; height: 60px; 
      border-radius: 50%; display: flex; align-items: center; justify-content: center; 
      color: white; font-size: 1.5rem; box-shadow: 0 4px 15px rgba(0,0,0,0.3); 
      z-index: 1040; cursor: pointer; text-decoration: none; transition: transform 0.2s;
    }
    .floating-cart:hover, .floating-whatsapp:hover { transform: scale(1.1); }
    .floating-cart { bottom: 90px; background: var(--primary); }
    .floating-whatsapp { bottom: 20px; background: #25D366; }
    .float-count { position: absolute; top: -5px; right: -5px; background: #ff4757; font-size: 0.75rem; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; border: 2px solid white; }

    .cart-sidebar { position: fixed; top: 0; right: -400px; width: 100%; max-width: 400px; height: 100vh; background: white; z-index: 1050; box-shadow: -5px 0 25px rgba(0,0,0,0.15); transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1); display: flex; flex-direction: column; }
    .cart-sidebar.open { right: 0; }
    .cart-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1045; display: none; backdrop-filter: blur(3px); }
    .cart-overlay.show { display: block; }
    
    .phone-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1060; display: none; align-items: center; justify-content: center; backdrop-filter: blur(3px); }
    .phone-modal.show { display: flex; }
    .phone-modal-content { background: white; width: 90%; max-width: 450px; border-radius: 15px; padding: 30px; box-shadow: 0 20px 50px rgba(0,0,0,0.2); }

    /* BLOGGER HIDES */
    #Blog1, .blog-posts, .post-outer, .date-header { display: none !important; }
  </style>
</head>

<body>

  <div class="toast-container position-fixed top-0 start-50 translate-middle-x p-3" style="z-index: 1070">
    <div id="notificationToast" class="toast align-items-center text-white bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="d-flex">
        <div class="toast-body"><i class="bi bi-check-circle-fill me-2"></i>Added to cart!</div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
    </div>
  </div>

  <div class="cart-overlay" id="cartOverlay"></div>
  <div class="cart-sidebar" id="cartSidebar">
    <div class="p-3 bg-primary text-white d-flex justify-content-between align-items-center shadow-sm">
      <h4 class="m-0 fw-bold"><i class="bi bi-bag-check me-2"></i>Your Order</h4>
      <i class="bi bi-x-lg" id="closeCart" style="cursor:pointer; font-size:1.2rem;"></i>
    </div>
    <div class="p-3 flex-grow-1 overflow-auto" id="cartBody">
      <div class="text-center mt-5 text-muted">
        <i class="bi bi-basket3 display-1 text-secondary opacity-25"></i>
        <p class="mt-3">Your cart is currently empty.</p>
      </div>
    </div>
    <div class="p-3 bg-white border-top">
      <div class="d-flex justify-content-between mb-3 fw-bold fs-5">
        <span>Total:</span>
        <span id="cartTotal" class="text-primary">0 DH</span>
      </div>
      <button class="btn btn-dark w-100 py-3 fw-bold rounded-pill shadow-sm" id="checkoutBtn">Proceed to Checkout</button>
    </div>
  </div>

  <div class="phone-modal" id="phoneModal">
    <div class="phone-modal-content">
      <h4 class="mb-4 fw-bold text-center">Complete Your Order</h4>
      <div class="mb-3">
        <label class="form-label fw-bold">Phone Number <span class="text-danger">*</span></label>
        <input type="tel" class="form-control form-control-lg" id="customerPhone" placeholder="06 00 00 00 00" />
      </div>
      <div class="mb-3">
        <label class="form-label">Name (Optional)</label>
        <input type="text" class="form-control" id="customerName" placeholder="Your Name" />
      </div>
      <div class="mb-3">
        <label class="form-label">Delivery Address</label>
        <textarea class="form-control" id="customerAddress" rows="2" placeholder="Street, Neighborhood..."></textarea>
      </div>
      <div class="d-flex gap-2 mt-4">
        <button class="btn btn-light border w-50" id="cancelCheckout">Cancel</button>
        <button class="btn btn-success w-50 fw-bold" id="confirmCheckout">Place Order</button>
      </div>
    </div>
  </div>

  <nav class="navbar navbar-expand-lg navbar-light">
    <div class="container">
      <a class="navbar-brand" href="#"><data:blog.title/></a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto align-items-center">
          <li class="nav-item"><a class="nav-link" href="#hero">Home</a></li>
          <li class="nav-item"><a class="nav-link" href="#menu">Menu</a></li>
          <li class="nav-item ms-2 d-none d-lg-block">
             <div class="input-group">
                <span class="input-group-text bg-light border-end-0"><i class="bi bi-search"></i></span>
                <input type="text" id="searchInput" class="form-control border-start-0 bg-light" placeholder="Search..." style="width: 200px;" />
             </div>
          </li>
          <li class="nav-item ms-3">
            <div class="nav-link position-relative" style="cursor:pointer" onclick="document.getElementById('cartSidebar').classList.add('open');document.getElementById('cartOverlay').classList.add('show')">
              <i class="bi bi-cart3 fs-4 text-primary"></i>
              <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" id="navCartCount" style="font-size:0.6rem;">0</span>
            </div>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <header id="hero">
    <div class="container">
      <h1 class="display-4 fw-bold">Event Sushi</h1>
      <p class="lead">Fresh. Authentic.</p>
      <a href="#menu" class="btn btn-lg shadow mt-3">Explore Menu</a>
    </div>
  </header>

  <section id="menu" style="padding: 50px 0;">
    <div class="container">
      <h2 class="text-center mb-2 fw-bold">Our Menu</h2>
      <p class="text-center text-muted mb-5">Handcrafted with premium ingredients</p>
      
      <div class="filter-container">
        <button class="filter-btn active" data-filter="all">All</button>
        <button class="filter-btn" data-filter="Minibox">Minibox</button>
        <button class="filter-btn" data-filter="Box">Box</button>
        <button class="filter-btn" data-filter="Appetizers">Appetizers</button>
        <button class="filter-btn" data-filter="Taco">Taco</button>
      </div>

      <div id="menuSections">
        <div class="text-center py-5">
          <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;"></div>
          <p class="mt-3 text-muted">Loading Menu...</p>
        </div>
      </div>
    </div>
  </section>

  <footer style="background:#212529; color:#adb5bd; padding:50px 0; text-align:center;">
    <div class="container">
      <h4 class="text-white mb-3"><data:blog.title/></h4>
      <p class="mb-4">
        <i class="bi bi-telephone-fill me-2"></i> <span class="mx-2">|</span>
        <i class="bi bi-envelope-fill me-2"></i>
      </p>
      <hr style="border-color:#495057; width:50%; margin:0 auto 20px;">
      <p class="small mb-0">&#169; 2025 All Rights Reserved.</p>
    </div>
  </footer>

  <div class="floating-cart" id="floatingCart" onclick="document.getElementById('cartSidebar').classList.add('open');document.getElementById('cartOverlay').classList.add('show')">
    <i class="bi bi-cart3"></i>
    <span class="float-count" id="floatCartCount">0</span>
  </div>
  <a href="#" id="floatingWhatsapp" class="floating-whatsapp" target="_blank">
    <i class="bi bi-whatsapp"></i>
  </a>

  <div style="display:none">
    <b:section id='main' showaddelement='yes'>
      <b:widget id='Blog1' locked='true' title='Blog Posts' type='Blog'/>
    </b:section>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
  //<![CDATA[
    document.addEventListener('DOMContentLoaded', function() {
      
      // --- CONFIGURATION ---
      const FEED_URL = '/feeds/posts/default?alt=json&max-results=50'; 
      const WHATSAPP_PHONE = "212600000000"; 
      const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbySV9PbNWxQTSdwrZ-1TOgJWI_LUTLlNgX3IO2ovLWjxt4vU13RAo-Sc0CLmzaVNVgc0w/exec'; // Injected by Backend

      // --- STATE ---
      let cart = JSON.parse(localStorage.getItem('eventSushiCart')) || [];
      let allPosts = [];

      // --- INIT ---
      fetchPosts();
      updateCartUI();
      setupEventListeners();

      // --- 1. ROBUST POST PARSER (SUSHI LOGIC) ---
      function fetchPosts() {
        fetch(FEED_URL)
          .then(response => response.json())
          .then(data => {
            if(!data.feed.entry) {
               document.getElementById('menuSections').innerHTML = "<div class='text-center p-5'><h3>No items found</h3><p>Create posts in Blogger to see them here.</p></div>";
               return;
            }
            allPosts = parseBloggerEntries(data.feed.entry);
            renderMenu(allPosts);
          })
          .catch(err => console.error("Feed Error:", err));
      }

      function parseBloggerEntries(entries) {
        return entries.map(entry => {
          const contentText = entry.content ? entry.content.$t : '';
          
          // Image Extraction Strategy
          const tempDiv = document.createElement('div');
          tempDiv.innerHTML = contentText;
          const firstImage = tempDiv.querySelector('img');
          
          let imageUrl = 'https://via.placeholder.com/600x400?text=No+Image';
          
          if (firstImage && firstImage.src) {
             imageUrl = firstImage.src; 
          } else if (entry.media$thumbnail) {
             // Upscale thumbnail
             imageUrl = entry.media$thumbnail.url.replace('s72-c', 's600'); 
          }

          // Tag Parsing
          let price = 0;
          let isSpecial = false;
          let category = 'Other';
          let tags = [];

          if (entry.category) {
            entry.category.forEach(cat => {
              const term = cat.term;
              tags.push(term);
              
              if (term.startsWith('price-')) price = parseFloat(term.replace('price-', ''));
              if (['Minibox', 'Box', 'Appetizers', 'Taco'].includes(term)) category = term;
              if (term === 'special-offer') isSpecial = true;
            });
          }

          return {
            id: entry.id.$t.split('post-')[1],
            title: entry.title.$t,
            desc: tempDiv.textContent.replace(/<[^>]*>/g, '').substring(0, 90) + '...', // Strip HTML
            image: imageUrl,
            price: price,
            category: category,
            isSpecial: isSpecial,
            tags: tags
          };
        });
      }

      // --- 2. RENDER MENU (GROUPED) ---
      function renderMenu(posts) {
        const categories = ['Minibox', 'Box', 'Appetizers', 'Taco'];
        let html = '';
        let foundAny = false;

        categories.forEach(cat => {
          const catPosts = posts.filter(p => p.category === cat);
          
          if (catPosts.length > 0) {
            foundAny = true;
            html += `
              <div class="category-section" id="${cat}-section">
                <div class="category-header ${cat.toLowerCase()}">
                  <h3 class="category-title" style="color:var(--${cat.toLowerCase()}-color)">${cat}</h3>
                </div>
                <div class="menu-grid">`;
            
            catPosts.forEach(post => {
              // FIX 4: Closed img tags
              html += `
                <div class="menu-item">
                  <div class="card-img-container">
                    <img src="${post.image}" alt="${post.title}" loading="lazy" />
                    <span class="price-badge">${post.price} DH</span>
                    ${post.isSpecial ? '<span class="special-offer">Special</span>' : ''}
                  </div>
                  <div class="card-body">
                    <h5 class="card-title">${post.title}</h5>
                    <p class="card-text">${post.desc}</p>
                  </div>
                  <div class="card-footer">
                    <div class="price-tag">${post.price} DH</div>
                    <button class="order-btn" onclick="addToCart('${post.id}')">
                      <i class="bi bi-cart-plus me-1"></i> Add
                    </button>
                  </div>
                </div>
              `;
            });
            html += `</div></div>`;
          }
        });
        
        if (!foundAny) {
           html = "<div class='text-center p-5'><h3>No Categories Found</h3><p>Ensure your posts have labels: Minibox, Box, Appetizers, or Taco.</p></div>";
        }
        
        document.getElementById('menuSections').innerHTML = html;
        
        // TRIGGER LAYOUT ENFORCER
        setTimeout(forceLayout, 200);
      }

      // --- 3. FILTER LOGIC ---
      function setupEventListeners() {
        document.querySelectorAll('.filter-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
             document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
             e.target.classList.add('active');
             const filter = e.target.dataset.filter;
             
             document.querySelectorAll('.category-section').forEach(sec => {
                if (filter === 'all' || sec.id.includes(filter)) {
                   sec.style.display = 'block';
                } else {
                   sec.style.display = 'none';
                }
             });
          });
        });

        // Search Logic
        const searchInput = document.getElementById('searchInput');
        if (searchInput) {
            searchInput.addEventListener('keyup', (e) => {
                const term = e.target.value.toLowerCase();
                const items = document.querySelectorAll('.menu-item');
                items.forEach(item => {
                    const title = item.querySelector('.card-title').innerText.toLowerCase();
                    if (title.includes(term)) {
                        item.style.display = 'flex'; // Must match Layout Enforcer
                    } else {
                        item.style.display = 'none';
                    }
                });
                // Re-run enforcer to fix grid gaps
                setTimeout(forceLayout, 50);
            });
        }

        // Cart Actions
        document.getElementById('closeCart').onclick = closeCart;
        document.getElementById('cartOverlay').onclick = closeCart;
        
        document.getElementById('checkoutBtn').onclick = () => {
           if (cart.length === 0) return alert("Cart is empty");
           closeCart();
           document.getElementById('phoneModal').classList.add('show');
        };
        
        document.getElementById('cancelCheckout').onclick = () => {
           document.getElementById('phoneModal').classList.remove('show');
        };
      }

      function closeCart() {
         document.getElementById('cartSidebar').classList.remove('open');
         document.getElementById('cartOverlay').classList.remove('show');
      }

      // --- 4. CART CORE ---
      window.addToCart = function(id) {
        const product = allPosts.find(p => p.id === id);
        const existing = cart.find(item => item.id === id);
        
        if (existing) existing.qty += 1;
        else cart.push({...product, qty: 1});
        
        saveCart();
        showToast();
      };

      window.changeQty = function(id, delta) {
        const item = cart.find(i => i.id === id);
        if (item) {
           item.qty += delta;
           if (item.qty <= 0) cart = cart.filter(i => i.id !== id);
           saveCart();
        }
      };

      function saveCart() {
        localStorage.setItem('eventSushiCart', JSON.stringify(cart));
        updateCartUI();
      }

      function updateCartUI() {
        const count = cart.reduce((acc, item) => acc + item.qty, 0);
        const total = cart.reduce((acc, item) => acc + (item.price * item.qty), 0);
        
        document.getElementById('navCartCount').textContent = count;
        document.getElementById('floatCartCount').textContent = count;
        document.getElementById('cartTotal').textContent = total.toFixed(2) + ' DH';
        
        const cartBody = document.getElementById('cartBody');
        if (cart.length === 0) {
           cartBody.innerHTML = '<div class="text-center mt-5 text-muted"><i class="bi bi-basket3 display-1 opacity-25"></i><p class="mt-3">Your cart is empty</p></div>';
           return;
        }
        
        let html = '';
        cart.forEach(item => {
           // FIX 4: Closed img tags
           html += `
             <div class="d-flex align-items-center justify-content-between mb-3 border-bottom pb-3">
                <div class="d-flex align-items-center">
                   <img src="${item.image}" class="rounded" style="width:60px; height:60px; object-fit:cover; margin-right:15px;" />
                   <div>
                      <div class="fw-bold text-dark" style="font-size:0.95rem;">${item.title}</div>
                      <div class="text-primary small fw-bold">${item.price} DH</div>
                   </div>
                </div>
                <div class="input-group input-group-sm" style="width: 90px;">
                   <button class="btn btn-outline-secondary" onclick="changeQty('${item.id}', -1)">-</button>
                   <span class="input-group-text bg-white">${item.qty}</span>
                   <button class="btn btn-outline-secondary" onclick="changeQty('${item.id}', 1)">+</button>
                </div>
             </div>
           `;
        });
        cartBody.innerHTML = html;
      }

      function showToast() {
         const el = document.getElementById('notificationToast');
         const toast = new bootstrap.Toast(el);
         toast.show();
      }

      // --- 5. CHECKOUT ---
      document.getElementById('confirmCheckout').onclick = function() {
         const btn = this;
         const phone = document.getElementById('customerPhone').value;
         const name = document.getElementById('customerName').value;
         const address = document.getElementById('customerAddress').value;
         
         if (!phone) return alert("Phone number is required");
         
         btn.disabled = true;
         btn.innerText = "Processing...";
         
         const total = cart.reduce((acc, i) => acc + (i.price * i.qty), 0);
         const summary = cart.map(i => `${i.qty}x ${i.title}`).join(', ');
         
         const orderData = {
            phone: phone, name: name, address: address,
            orderDetails: summary, totalAmount: total + " DH"
         };
         
         const script = document.createElement('script');
         const cb = 'cb_' + Date.now();
         
         window[cb] = function(res) {
            const msg = `*New Order*\n\n${summary}\nTotal: ${total} DH\n\nName: ${name}\nPhone: ${phone}\nAddress: ${address}`;
            const url = `https://wa.me/${WHATSAPP_PHONE}?text=${encodeURIComponent(msg)}`;
            
            cart = [];
            saveCart();
            window.open(url, '_blank');
            location.reload();
         };
         
         script.src = `${WEB_APP_URL}?callback=${cb}&action=save_order&data=${encodeURIComponent(JSON.stringify(orderData))}`;
         document.body.appendChild(script);
      };

      // --- 6. LAYOUT ENFORCER (Prevents Vertical Stacking) ---
      function forceLayout() {
         const items = document.querySelectorAll('.menu-item');
         items.forEach(item => {
            const isMobile = window.innerWidth < 768;
            // Force reset display properties overridden by Blogger
            item.style.cssText = `
                display: flex !important;
                flex-direction: column !important;
                background: #fff !important;
                border-radius: 15px !important;
                overflow: hidden !important;
                box-shadow: 0 5px 15px rgba(0,0,0,0.05) !important;
                height: 100% !important;
                width: ${isMobile ? '100%' : 'auto'} !important;
            `;
         });
         
         const grids = document.querySelectorAll('.menu-grid');
         grids.forEach(g => {
            g.style.cssText = `
                display: grid !important;
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)) !important;
                gap: 25px !important;
            `;
         });
      }
      
      setInterval(forceLayout, 500);
      window.addEventListener('resize', forceLayout);

    });
  //]]>
  </script>
</body>
</html>